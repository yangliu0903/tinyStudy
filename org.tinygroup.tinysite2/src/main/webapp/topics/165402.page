#pageTitle("topic","topic")
#title("Tiny框架","主题切换及其管理 ")
#[[<div class="BlogContent"><p>想做一个更换主题的功能</p><p>第一步，做主题管理：</p><p><br></br></p><pre class="brush:xml; toolbar: true; auto-links: false;">&lt;entity-model id=&quot;theme&quot; name=&quot;theme&quot; title=&quot;主题&quot;
	enable-delete=&quot;true&quot; enable-modity=&quot;true&quot; version=&quot;2.0&quot; cache-enabled=&quot;true&quot;&gt;
	&lt;operations&gt;
		&lt;operation id=&quot;thememodelopadduuid&quot; name=&quot;addTheme&quot; title=&quot;新增&quot;
			enable-delete=&quot;true&quot; enable-modity=&quot;true&quot; type=&quot;add&quot; fixed-size=&quot;false&quot;
			modal=&quot;true&quot;&gt;
			&lt;condition-fields&gt;
				&lt;condition-field editable=&quot;false&quot; hidden=&quot;false&quot;
					field-id=&quot;theme_id&quot; connect-mode=&quot;AND&quot; /&gt;
			&lt;/condition-fields&gt;
			&lt;operation-group id=&quot;addopbasicgroup&quot; name=&quot;basicgroup&quot;
				title=&quot;操作字段&quot; enable-delete=&quot;true&quot; enable-modity=&quot;true&quot;&gt;
				&lt;operation-fields&gt;
					&lt;operation-field editable=&quot;false&quot; hidden=&quot;true&quot;
						field-id=&quot;theme_id&quot; /&gt;
					&lt;operation-field editable=&quot;true&quot; hidden=&quot;false&quot;
						field-id=&quot;theme_code&quot; /&gt;
					&lt;operation-field editable=&quot;true&quot; hidden=&quot;false&quot;
						field-id=&quot;theme_title&quot; /&gt;
					&lt;operation-field editable=&quot;true&quot; hidden=&quot;false&quot;
						field-id=&quot;theme_css_path&quot;&gt;
						&lt;input-mode type=&quot;textWholeLineMode&quot;&gt;&lt;/input-mode&gt;
					&lt;/operation-field&gt;
					&lt;operation-field editable=&quot;true&quot; hidden=&quot;false&quot;
						field-id=&quot;theme_thumbnail&quot;&gt;
						&lt;input-mode type=&quot;textWholeLineMode&quot;&gt;&lt;/input-mode&gt;
					&lt;/operation-field&gt;
				&lt;/operation-fields&gt;
			&lt;/operation-group&gt;
		&lt;/operation&gt;
		&lt;operation id=&quot;thememodelopupdateuuid&quot; name=&quot;modifyTheme&quot;
			title=&quot;修改&quot; enable-delete=&quot;true&quot; enable-modity=&quot;true&quot; type=&quot;modify&quot;
			fixed-size=&quot;false&quot; modal=&quot;true&quot;&gt;
			&lt;condition-fields&gt;
				&lt;condition-field editable=&quot;false&quot; hidden=&quot;false&quot;
					field-id=&quot;theme_id&quot; connect-mode=&quot;AND&quot; /&gt;
			&lt;/condition-fields&gt;
			&lt;operation-group id=&quot;modifyopbasicgroup&quot; name=&quot;basicgroup&quot;
				title=&quot;操作字段&quot; enable-delete=&quot;true&quot; enable-modity=&quot;true&quot;&gt;
				&lt;operation-fields&gt;
					&lt;operation-field editable=&quot;false&quot; hidden=&quot;true&quot;
						field-id=&quot;theme_id&quot; /&gt;
					&lt;operation-field editable=&quot;true&quot; hidden=&quot;false&quot;
						field-id=&quot;theme_code&quot; /&gt;
					&lt;operation-field editable=&quot;true&quot; hidden=&quot;false&quot;
						field-id=&quot;theme_title&quot; /&gt;
					&lt;operation-field editable=&quot;true&quot; hidden=&quot;false&quot;
						field-id=&quot;theme_css_path&quot;&gt;
						&lt;input-mode type=&quot;textWholeLineMode&quot;&gt;&lt;/input-mode&gt;
					&lt;/operation-field&gt;
					&lt;operation-field editable=&quot;true&quot; hidden=&quot;false&quot;
						field-id=&quot;theme_thumbnail&quot;&gt;
						&lt;input-mode type=&quot;textWholeLineMode&quot;&gt;&lt;/input-mode&gt;
					&lt;/operation-field&gt;
				&lt;/operation-fields&gt;
			&lt;/operation-group&gt;
		&lt;/operation&gt;
		&lt;operation id=&quot;thememodelopdeleteuuid&quot; name=&quot;deleteTheme&quot;
			title=&quot;删除&quot; enable-delete=&quot;true&quot; enable-modity=&quot;true&quot; type=&quot;delete&quot;
			fixed-size=&quot;false&quot; modal=&quot;true&quot;&gt;
			&lt;condition-fields&gt;
				&lt;condition-field editable=&quot;false&quot; hidden=&quot;false&quot;
					field-id=&quot;theme_id&quot; connect-mode=&quot;AND&quot; /&gt;
			&lt;/condition-fields&gt;
			&lt;operation-group id=&quot;deleteopbasicgroup&quot; name=&quot;basicgroup&quot;
				title=&quot;操作字段&quot; enable-delete=&quot;true&quot; enable-modity=&quot;true&quot;&gt;
				&lt;operation-fields&gt;
					&lt;operation-field editable=&quot;false&quot; hidden=&quot;true&quot;
						field-id=&quot;theme_id&quot; /&gt;
					&lt;operation-field editable=&quot;true&quot; hidden=&quot;false&quot;
						field-id=&quot;theme_code&quot; /&gt;
					&lt;operation-field editable=&quot;true&quot; hidden=&quot;false&quot;
						field-id=&quot;theme_title&quot; /&gt;
					&lt;operation-field editable=&quot;true&quot; hidden=&quot;false&quot;
						field-id=&quot;theme_css_path&quot; /&gt;
					&lt;operation-field editable=&quot;true&quot; hidden=&quot;false&quot;
						field-id=&quot;theme_thumbnail&quot; /&gt;
				&lt;/operation-fields&gt;
			&lt;/operation-group&gt;
		&lt;/operation&gt;
		&lt;operation id=&quot;thememodelopqueryuuid&quot; name=&quot;viewTheme&quot;
			title=&quot;查看&quot; enable-delete=&quot;true&quot; enable-modity=&quot;true&quot; type=&quot;view&quot;
			fixed-size=&quot;false&quot; modal=&quot;true&quot;&gt;
			&lt;condition-fields&gt;
				&lt;condition-field editable=&quot;false&quot; hidden=&quot;false&quot;
					field-id=&quot;theme_id&quot; connect-mode=&quot;AND&quot; /&gt;
			&lt;/condition-fields&gt;
			&lt;operation-group id=&quot;viewopbasicgroup&quot; name=&quot;basicgroup&quot;
				title=&quot;操作字段&quot; enable-delete=&quot;true&quot; enable-modity=&quot;true&quot;&gt;
				&lt;operation-fields&gt;
					&lt;operation-field editable=&quot;false&quot; hidden=&quot;true&quot;
						field-id=&quot;theme_id&quot; /&gt;
					&lt;operation-field editable=&quot;true&quot; hidden=&quot;false&quot;
						field-id=&quot;theme_code&quot; /&gt;
					&lt;operation-field editable=&quot;true&quot; hidden=&quot;false&quot;
						field-id=&quot;theme_title&quot; /&gt;
					&lt;operation-field editable=&quot;true&quot; hidden=&quot;false&quot;
						field-id=&quot;theme_css_path&quot;&gt;
						&lt;input-mode type=&quot;labelWholeLineMode&quot;&gt;&lt;/input-mode&gt;
					&lt;/operation-field&gt;
					&lt;operation-field editable=&quot;true&quot; hidden=&quot;false&quot;
						field-id=&quot;theme_thumbnail&quot;&gt;
						&lt;input-mode type=&quot;labelWholeLineMode&quot;&gt;&lt;/input-mode&gt;
					&lt;/operation-field&gt;
				&lt;/operation-fields&gt;
			&lt;/operation-group&gt;
		&lt;/operation&gt;
		&lt;operation id=&quot;thememodelopaddcopyuuid&quot; name=&quot;copyAddTheme&quot;
			title=&quot;拷贝新增&quot; enable-delete=&quot;true&quot; enable-modity=&quot;true&quot; type=&quot;copyAdd&quot;
			fixed-size=&quot;false&quot; modal=&quot;true&quot;&gt;
			&lt;condition-fields&gt;
				&lt;condition-field editable=&quot;false&quot; hidden=&quot;false&quot;
					field-id=&quot;theme_id&quot; connect-mode=&quot;AND&quot; /&gt;
			&lt;/condition-fields&gt;
			&lt;operation-group id=&quot;copyAddopbasicgroup&quot; name=&quot;basicgroup&quot;
				title=&quot;操作字段&quot; enable-delete=&quot;true&quot; enable-modity=&quot;true&quot;&gt;
				&lt;operation-fields&gt;
					&lt;operation-field editable=&quot;true&quot; hidden=&quot;false&quot;
						field-id=&quot;theme_code&quot; /&gt;
					&lt;operation-field editable=&quot;true&quot; hidden=&quot;false&quot;
						field-id=&quot;theme_title&quot; /&gt;
					&lt;operation-field editable=&quot;true&quot; hidden=&quot;false&quot;
						field-id=&quot;theme_css_path&quot;&gt;
						&lt;input-mode type=&quot;textWholeLineMode&quot;&gt;&lt;/input-mode&gt;
					&lt;/operation-field&gt;
					&lt;operation-field editable=&quot;true&quot; hidden=&quot;false&quot;
						field-id=&quot;theme_thumbnail&quot;&gt;
						&lt;input-mode type=&quot;textWholeLineMode&quot;&gt;&lt;/input-mode&gt;
					&lt;/operation-field&gt;
				&lt;/operation-fields&gt;
			&lt;/operation-group&gt;
		&lt;/operation&gt;
	&lt;/operations&gt;
	&lt;views&gt;
		&lt;view id=&quot;thememodeloptableuuid&quot; name=&quot;tabletheme&quot; title=&quot;主题管理&quot;
			enable-delete=&quot;true&quot; enable-modity=&quot;true&quot; type=&quot;table&quot; page-size=&quot;10&quot;
			allow-edit=&quot;false&quot; allow-filter-front=&quot;false&quot; fixed-size=&quot;false&quot;
			modal=&quot;false&quot; front-paging=&quot;false&quot;&gt;
			&lt;view-groups&gt;
				&lt;view-group id=&quot;viewbasicgroup&quot; name=&quot;basicgroup&quot; title=&quot;基本信息&quot;
					enable-delete=&quot;true&quot; enable-modity=&quot;true&quot;&gt;
					&lt;display-field editable=&quot;false&quot; hidden=&quot;true&quot;
						field-id=&quot;theme_id&quot; aggregate-by-view=&quot;false&quot; /&gt;
					&lt;display-field editable=&quot;false&quot; hidden=&quot;false&quot;
						field-id=&quot;theme_code&quot; aggregate-by-view=&quot;false&quot; /&gt;
					&lt;display-field editable=&quot;false&quot; hidden=&quot;false&quot;
						field-id=&quot;theme_title&quot; aggregate-by-view=&quot;false&quot; /&gt;
				&lt;/view-group&gt;
			&lt;/view-groups&gt;
			&lt;references&gt;
				&lt;operation-reference type=&quot;operation&quot; id=&quot;thememodelopadduuid&quot; /&gt;
				&lt;operation-reference type=&quot;operation&quot;
					id=&quot;thememodelopaddcopyuuid&quot; /&gt;
				&lt;operation-reference type=&quot;operation&quot;
					id=&quot;thememodelopdeleteuuid&quot; /&gt;
				&lt;operation-reference type=&quot;operation&quot;
					id=&quot;thememodelopupdateuuid&quot; /&gt;
				&lt;operation-reference type=&quot;operation&quot;
					id=&quot;thememodelopqueryuuid&quot; /&gt;
			&lt;/references&gt;
		&lt;/view&gt;
	&lt;/views&gt;
	&lt;groups&gt;
		&lt;group id=&quot;basicgroup&quot; name=&quot;basicgroup&quot; title=&quot;基本字段&quot;
			enable-delete=&quot;true&quot; enable-modity=&quot;true&quot;&gt;
			&lt;field standard-field-id=&quot;theme_id&quot; primary=&quot;true&quot; unique=&quot;true&quot;
				display=&quot;false&quot; not-null=&quot;false&quot; auto-increase=&quot;false&quot; editable=&quot;false&quot;
				hidden=&quot;false&quot; table-field=&quot;true&quot; id=&quot;theme_id&quot; /&gt;
			&lt;field standard-field-id=&quot;theme_code&quot; primary=&quot;false&quot; unique=&quot;false&quot;
				display=&quot;false&quot; not-null=&quot;false&quot; auto-increase=&quot;false&quot; editable=&quot;false&quot;
				hidden=&quot;false&quot; table-field=&quot;true&quot; id=&quot;theme_code&quot; /&gt;
			&lt;field standard-field-id=&quot;theme_title&quot; primary=&quot;false&quot; unique=&quot;false&quot;
				display=&quot;false&quot; not-null=&quot;false&quot; auto-increase=&quot;false&quot; editable=&quot;false&quot;
				hidden=&quot;false&quot; table-field=&quot;true&quot; id=&quot;theme_title&quot; /&gt;
			&lt;field standard-field-id=&quot;theme_css_path&quot; primary=&quot;false&quot;
				unique=&quot;false&quot; display=&quot;false&quot; not-null=&quot;false&quot; auto-increase=&quot;false&quot;
				editable=&quot;false&quot; hidden=&quot;false&quot; table-field=&quot;true&quot; id=&quot;theme_css_path&quot; /&gt;
			&lt;field standard-field-id=&quot;theme_thumbnail&quot; primary=&quot;false&quot;
				unique=&quot;false&quot; display=&quot;false&quot; not-null=&quot;false&quot; auto-increase=&quot;false&quot;
				editable=&quot;false&quot; hidden=&quot;false&quot; table-field=&quot;true&quot; id=&quot;theme_thumbnail&quot; /&gt;
		&lt;/group&gt;
	&lt;/groups&gt;
&lt;/entity-model&gt;</pre>OK，管理功能就算开发完毕了。<p><br></br></p><p>主窗口如下：</p><p><img src="http://static.oschina.net/uploads/space/2013/0930/133934_g7tm_1245989.png" alt=""></img></p><p>新增窗口如下：</p><p><img src="http://static.oschina.net/uploads/space/2013/0930/134049_IROG_1245989.png" alt=""></img></p><p>复制新增如下：</p><p><img src="http://static.oschina.net/uploads/space/2013/0930/134159_jRIU_1245989.png" alt=""></img></p><p>修改窗口：</p><p><img src="http://static.oschina.net/uploads/space/2013/0930/134322_hUTV_1245989.png" alt=""></img></p><p>查看窗口：</p><p><img src="http://static.oschina.net/uploads/space/2013/0930/134448_2wNI_1245989.png" alt=""></img></p><p>删除确认窗口：</p><p><img src="http://static.oschina.net/uploads/space/2013/0930/135042_bixc_1245989.png" alt=""></img></p><p>至此，通过配置xml，主题的管理功能开发完毕。</p><p>于是，增加数据，由于有拷贝新增，因此增加起来还是比较快速的。</p><p>第二步，做主题选择对话框：</p><p>增加一个新的view</p><p><span style="font-family:&apos;Courier New&apos;, Arial;font-size:9pt;line-height:1.5;"></span></p><pre class="brush:xml; toolbar: true; auto-links: false;">&lt;view id=&quot;thememodelopcarduuid&quot; name=&quot;cardtheme&quot; title=&quot;主题选择&quot;
	enable-delete=&quot;true&quot; enable-modity=&quot;true&quot; type=&quot;card&quot; page-size=&quot;0&quot;
	allow-edit=&quot;false&quot; allow-filter-front=&quot;true&quot; fixed-size=&quot;false&quot;
	modal=&quot;false&quot; front-paging=&quot;false&quot;&gt;
	&lt;customize-stage-configs&gt;
		&lt;customize-stage-config stage-name=&quot;card&quot;
			view-path=&quot;/biz/theme/theme_card.page&quot;&gt;
		&lt;/customize-stage-config&gt;
	&lt;/customize-stage-configs&gt;
	&lt;condition-fields&gt;
	&lt;/condition-fields&gt;
	&lt;view-groups&gt;
		&lt;view-group id=&quot;viewbasicgroup&quot; name=&quot;basicgroup&quot; title=&quot;基本信息&quot;
			enable-delete=&quot;true&quot; enable-modity=&quot;true&quot;&gt;
			&lt;display-field editable=&quot;false&quot; hidden=&quot;true&quot;
				field-id=&quot;theme_id&quot; aggregate-by-view=&quot;false&quot; /&gt;
			&lt;display-field editable=&quot;false&quot; hidden=&quot;false&quot;
				field-id=&quot;theme_code&quot; aggregate-by-view=&quot;false&quot; /&gt;
			&lt;display-field editable=&quot;false&quot; hidden=&quot;false&quot;
				field-id=&quot;theme_title&quot; aggregate-by-view=&quot;false&quot; /&gt;
			&lt;display-field editable=&quot;false&quot; hidden=&quot;false&quot;
				field-id=&quot;theme_css_path&quot; aggregate-by-view=&quot;false&quot; /&gt;
			&lt;display-field editable=&quot;false&quot; hidden=&quot;false&quot;
				field-id=&quot;theme_thumbnail&quot; aggregate-by-view=&quot;false&quot; /&gt;
		&lt;/view-group&gt;
	&lt;/view-groups&gt;
&lt;/view&gt;</pre>编写视图中指定的模板文件：<p><span style="font-family:&apos;Courier New&apos;, Arial;font-size:9pt;line-height:1.5;"></span></p><pre class="brush:html; toolbar: true; auto-links: false;">#@wijDialog(&quot;${modelDefine.id}_${operationDefine.id}&quot; &quot;${operationDefine.title}&quot;)
#foreach($bean in $modelProcessResult.beans)
	&lt;a href=&quot;javascript:doChangeTheme(&apos;${TINY_CONTEXT_PATH}$bean.themeCssPath&apos;)&quot;&gt;&lt;img title=&quot;$bean.themeTitle&quot; style=&quot;float:left;border:1px solid;margin:5px 5px;width:50pt;&quot; src=&quot;${TINY_CONTEXT_PATH}$bean.themeThumbnail&quot; /&gt;&lt;/a&gt;
#end
#end

&lt;script&gt;
	function doChangeTheme(path){
		var list=$(&quot;link&quot;);
		for(var i=0;i&lt;list.length;i++){
			var link=list.get(i);
			var pos=link.href.indexOf(&quot;/themes/&quot;);
			if(pos&gt;0){
				pos=link.href.indexOf(contextPath+&quot;/&quot;);
				link.href=link.href.substr(0,pos)+ path;
				return;
			}
		}
	}

&lt;/script&gt;</pre>至此开发任务完成，看一下模板选择界面<p><span style="font-family:&apos;Courier New&apos;, Arial;font-size:9pt;line-height:1.5;"><img src="http://static.oschina.net/uploads/space/2013/0930/140118_agO1_1245989.png" alt=""></img><br></br></span></p><p>第三步，验证实际效果：</p><p><img src="http://static.oschina.net/uploads/space/2013/0930/140340_23Zk_1245989.png" alt=""></img></p><p><img src="http://static.oschina.net/uploads/space/2013/0930/140418_IjRs_1245989.png" alt=""></img></p><p><img src="http://static.oschina.net/uploads/space/2013/0930/140459_KqHs_1245989.png" alt=""></img></p><p>OK，收工。</p><p>操作录像：</p><p><a href="http://sourceforge.net/projects/tinyorg/files/demo.mp4/download" target="_blank" rel="nofollow">http://sourceforge.net/projects/tinyorg/files/demo.mp4/download</a></p></div>]]#